version: '2'
services:

  ### Limonero ###
  limonero_db:
    image: mysql
    environment:
      - MYSQL_ROOT_PASSWORD=root
      - MYSQL_DATABASE=limonero
  limonero:
    build: ./limonero
    links:
      - limonero_db:mysql
    volumes:
      - ./limonero-config.yaml:/usr/local/limonero/conf/limonero-config.yaml
    ports:
      - '5000:5000'

  ### Juicer ###
  juicer:
    build: ./juicer
    tty: true
    stdin_open: true
    volumes:
       - ./juicer-config.yaml:/usr/local/juicer/conf/juicer-config.yaml

  ### Stand ###
  stand:
     build: ./stand
     tty: true
     stdin_open: true
     volumes:
        - ./stand-config.yaml:/usr/local/stand/conf/stand-config.yaml
     ports:
        - '5001:5000'
  
  ### Caipirinha ###
  caipirinha:
     build: ./stand
     tty: true
     stdin_open: true
     volumes:
        - ./caipirinha-config.yaml:/usr/local/caipirinha/conf/caipirinha-config.yaml
     ports:
        - '5002:5000'

  ### Tahiti ###
  tahiti:
     build: ./tahiti
     tty: true
     stdin_open: true
     volumes:
        - ./tahiti-config.yaml:/usr/local/tahiti/conf/tahiti-config.yaml
     ports:
        - '5003:5000'

  ### Tahiti ###
  torn_db:
     image: mysql
     environment:
        - MYSQL_ROOT_PASSWORD=root
     volumes:
        - /var/run/mysqld/
  torn:
     build: ./torn
     environment:
        - RAILS_CORS_ORIGINS=localhost:8080
     volumes:
        - ./database.yml:/usr/src/app/config/database.yml
     volumes_from:
        - torn_db
     ports:
        - '3000:3000'
  
  ### Citron ###
  citron:
     image: nginx
     ports:
        - '443:443'
        - '80:80'
     volumes:
        - ./ember-citron/dist:/usr/share/nginx/html
        - ./nginx.conf:/etc/nginx/conf.d/default.conf
     links:
        - torn

  ### Redis ###
  redis:
    image: "redis"
